<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pokemon Matching Game</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <style></style>
  <body>
    <div class="navbar">
      <a class="navbar-item" href="index.html">Home</a>
      <a class="navbar-item" href="hunt.html">Poke Hunt</a>
      <a class="navbar-item" href="list.html">Pokemon List</a>
      <a class="navbar-item" href="who.html">Who's That Pokemon</a>
      <a class="navbar-item" href="pokedex.html">Name The Pokedex</a>
      <a class="navbar-item" href="match.html">Pokemon Matching Game</a>
    </div>
    <div><h1>Match The Pokemon</h1></div>
    <div class="main-content">
      <div class="card_count">
        <button id="12">12 Cards</button>
        <button id="24">24 Cards</button>
      </div>
      <div id="timer">Time Remaining:</div>

      <div class="game-grid" id="grid">
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
        <div class="card card-border"><img src="" alt="" class="hidden" /></div>
      </div>
      <p id="status"></p>
      <button id="resetBtn">Reset Game</button>
    </div>

    <footer class="footer">
      <div>
        <p>Developed By Coby Hughes</p>
        <a
          href="https://github.com/c-o-b-a-x"
          target="_blank"
          class="github-link"
        >
          <img
            src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg"
            alt="GitHub Logo"
            class="github-logo"
          />
        </a>
      </div>
    </footer>
    <script>
      let time = 30;
      let id = 6;
      let count = 0;
      const time_display = document.getElementById("timer");
      const grid = document.getElementById("grid");
      const twelve = document.getElementById("12");
      const twentyfour = document.getElementById("24");

      function reset() {
        cards.forEach((card) => {
          card.classList.remove("flipped");
          card.querySelector("img").classList.add("hidden");
        });

        flippedCards = [];
        matchedCards = 0;
        lockBoard = false;

        const status = document.getElementById("status");
        status.innerText = "";
        time = id * 5;
        loadPokemonImages();
      }

      twentyfour.addEventListener("click", () => {
        time = 30;
        grid.style.gridTemplateColumns = "repeat(6, 200px)";
        grid.style.gridTemplateRows = "repeat(4, 200px)";
        id = 12;
        timer(id);
        reset();
      });
      twelve.addEventListener("click", () => {
        time = 20;

        grid.style.gridTemplateColumns = "repeat(6, 300px)";
        grid.style.gridTemplateRows = "repeat(2, 300px)";

        id = 6;
        timer(id);
        reset();
      });
      const cards = document.querySelectorAll(".card");
      let flippedCards = [];
      let lockBoard = false;

      async function loadPokemonImages() {
        let pokemonImages = [];
        for (let i = 0; i < Number(id); i++) {
          const randomId = Math.floor(Math.random() * 898) + 1;
          const res = await fetch(
            `https://pokeapi.co/api/v2/pokemon/${randomId}`
          );
          console.log(res);
          const data = await res.json();
          pokemonImages.push(
            data.sprites.other["official-artwork"].front_default
          );
        }

        pokemonImages = [...pokemonImages, ...pokemonImages];

        for (let i = pokemonImages.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [pokemonImages[i], pokemonImages[j]] = [
            pokemonImages[j],
            pokemonImages[i],
          ];
        }

        cards.forEach((card, index) => {
          const img = card.querySelector("img");
          img.src = pokemonImages[index];
          img.alt = "Pokemon";
        });
      }

      cards.forEach((card) => {
        card.addEventListener("click", () => {
          if (lockBoard) return;
          if (card.classList.contains("flipped")) return;

          card.classList.add("flipped");
          for (let i = 0; i < id; i++) {
            card.querySelector("img").classList.remove("hidden");
          }
          flippedCards.push(card);

          if (flippedCards.length === 2) {
            checkForMatch();
          }
        });
      });
      let timerInterval;

      function timer(id) {
        clearInterval(timerInterval);
        timerInterval = setInterval(function () {
          time_display.innerText = "Time Remaining: " + time;
          time -= 1;
          if (time <= 0) {
            time = 0;
            clearInterval(timerInterval);
            count = 0;
            cards.forEach((card) => {
              if (count < id * 2) {
                const img = card.querySelector("img");
                img.classList.remove("hidden");
                count++;
              }
            });
          }
        }, 1000);
      }

      let matchedCards = 0;

      function checkForMatch() {
        const [card1, card2] = flippedCards;
        const img1 = card1.querySelector("img").src;
        const img2 = card2.querySelector("img").src;

        if (img1 === img2) {
          matchedCards += 2;
          flippedCards = [];

          if (matchedCards === cards.length) {
            console.log("win");
            const status = document.getElementById("status");
            status.innerText = "YOU WIN!!!";
          }
        } else {
          lockBoard = true;
          setTimeout(() => {
            flippedCards.forEach((card) => {
              card.classList.remove("flipped");
              card.querySelector("img").classList.add("hidden");
            });
            flippedCards = [];
            lockBoard = false;
          }, 1000);
        }
      }
      const resetBtn = document.getElementById("resetBtn");
      resetBtn.addEventListener("click", () => {
        reset();
      });

      loadPokemonImages();
      timer(id);
    </script>
  </body>
</html>
